# Copyright (c) 2014 The Sundial Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file. See the AUTHORS file for names of contributors.
###############################################################################

# this file is generated by `./tools/configure.sh` script to set build flags
# include ../build_config.mk

TIMESTAMP= `date '+%Y%m%d%H%M%S'`

COMMON_FLAGS= -g -I. -I../include $(MY_COMMON_FLAGS)

CCFLAGS= $(COMMON_FLAGS) $(PLATFORM_CCFLAGS) $(MY_CFLAGS)
CXXFLAGS= $(COMMON_FLAGS) $(PLATFORM_CXXFLAGS) $(MY_CCFLAGS)

LDFLAGS= $(PLATFORM_SHARED_LDFLAGS) $(PLATFORM_LDFLAGS) $(MY_LDFLAGS)
LIBS= $(PLATFORM_LIBS) $(MY_LIBS)

OBJS= $(SRC_cc:.cc=.o) $(SRC_c:.c=.o)

.SUFFIXES: .c .cc .h .o

cc_bin: $(OBJS)
	@echo $(ECHO_OPT) "Building $(EXE) ... \c"
	@$(CXX) -o $(EXE).make $(CXXFLAGS) $(OBJS) $(LIBS)
	@echo OK
	@-if test -r $(EXE); then echo "Backup $(EXE) -> $(EXE)_$(TIMESTAMP)"; else echo "NO Backup $(EXE) !!!"; fi
	@-if test -r $(EXE); then mv -f $(EXE) $(EXE)_$(TIMESTAMP); fi
	@mv -f $(EXE).make $(EXE)
	@echo "--->>>>>>>>> MAKE OK <<<<<<<<<---"

c_bin: $(OBJS)
	@echo $(ECHO_OPT) "Building $(EXE) ... \c"
	@$(CC) -o $(EXE).make $(CCFLAGS) $(OBJS) $(LIBS)
	@echo OK
	@-if test -r $(EXE); then echo "Backup $(EXE) -> $(EXE)_$(TIMESTAMP)"; else echo "NO Backup $(EXE) !!!"; fi
	@-if test -r $(EXE); then mv -f $(EXE) $(EXE)_$(TIMESTAMP); fi
	@mv -f $(EXE).make $(EXE)
	@echo "--->>>>>>>>> MAKE OK <<<<<<<<<---"

cc_shared_lib: clean $(OBJS)
	@echo $(ECHO_OPT) "Building $(EXE) ... \c"
	@$(CXX_LD) $(LDFLAGS) -o $(EXE).make $(OBJS) $(LIBS)
	@echo OK
	@-if test -r $(EXE); then echo "Backup $(EXE) -> $(EXE)_$(TIMESTAMP)"; else echo "NO Backup $(EXE) !!!"; fi
	@-if test -r $(EXE); then mv -f $(EXE) $(EXE)_$(TIMESTAMP); fi
	@mv -f $(EXE).make $(EXE)
	@echo "--->>>>>>>>> MAKE OK <<<<<<<<<---"

c_shared_lib: clean $(OBJS)
	@echo $(ECHO_OPT) "Building $(EXE) ... \c"
	@$(CC_LD) $(LDFLAGS) -o $(EXE).make $(OBJS) $(LIBS)
	@echo OK
	@-if test -r $(EXE); then echo "Backup $(EXE) -> $(EXE)_$(TIMESTAMP)"; else echo "NO Backup $(EXE) !!!"; fi
	@-if test -r $(EXE); then mv -f $(EXE) $(EXE)_$(TIMESTAMP); fi
	@mv -f $(EXE).make $(EXE)
	@echo "--->>>>>>>>> MAKE OK <<<<<<<<<---"

static_lib: $(OBJS)
	@echo $(ECHO_OPT) "Building $(EXE) ... \c"
	@$(AR) $(ARFLAGS) $(EXE).make $(OBJS)
	@echo OK
	@-if test -r $(EXE); then echo "Backup $(EXE) -> $(EXE)_$(TIMESTAMP)"; else echo "NO Backup $(EXE) !!!"; fi
	@-if test -r $(EXE); then mv -f $(EXE) $(EXE)_$(TIMESTAMP); fi
	@mv -f $(EXE).make $(EXE)
	@echo "--->>>>>>>>> MAKE OK <<<<<<<<<---"


.PHONY: clean

clean:
	@-rm -f $(OBJS) *~
	@echo '.o removed'

.cc.o:
	@echo $(ECHO_OPT) "$(CXX) $< ... \c"
	@$(CXX) -o $@ -c $(CXXFLAGS) $<
	@echo OK

.c.o:
	@echo $(ECHO_OPT) "$(CC) $< ... \c"
	@$(CC) -o $@ -c $(CCFLAGS) $<
	@echo OK

